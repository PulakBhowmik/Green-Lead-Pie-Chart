<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Housing Interventions</title>

<!-- Styles -->
<style>
body {
  font-family: Arial, sans-serif;
  margin: 20px;
}

.container {
  display: flex;
  gap: 30px;
  align-items: flex-start;
}

.table-section,
.chart-section {
  flex: 1;
  min-width: 300px;
}

table {
  width: 100%;
  border-collapse: collapse;
  font-size: 15px;
}

th, td {
  border: 1px solid #ccc;
  padding: 12px;
  text-align: left;
}

th {
  background-color: #28a745;
  color: white;
  font-weight: bold;
}

tr:nth-child(even) {
  background-color: #f6f8fb;
}

tr.total {
  font-weight: bold;
  background-color: #e4f6e7;
}

#chartdiv {
  width: 100%;
  height: 400px;
}

@media (max-width: 900px) {
  .container {
    flex-direction: column;
  }
  #chartdiv {
    height: 300px;
  }
}
</style>

<!-- amCharts -->
<script src="https://cdn.amcharts.com/lib/5/index.js"></script>
<script src="https://cdn.amcharts.com/lib/5/xy.js"></script>
<script src="https://cdn.amcharts.com/lib/5/themes/Animated.js"></script>
</head>
<body>

<h2>Housing Interventions</h2>

<div class="container">

  <!-- TABLE -->
  <div class="table-section">
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Households</th>
          <th>Percentage</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>New Construction</td>
          <td>16</td>
          <td>≈55%</td>
        </tr>
        <tr>
          <td>Renovation</td>
          <td>13</td>
          <td>≈45%</td>
        </tr>
        <tr class="total">
          <td>Total</td>
          <td>29</td>
          <td>100%</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- CHART -->
  <div class="chart-section">
    <div id="chartdiv"></div>
  </div>

</div>

<script>
am5.ready(function() {

  var root = am5.Root.new("chartdiv");

  // Custom theme for grid opacity
  var myTheme = am5.Theme.new(root);
  myTheme.rule("Grid", ["base"]).setAll({
    strokeOpacity: 0.1
  });

  root.setThemes([
    am5themes_Animated.new(root),
    myTheme
  ]);

  // Create chart
  var chart = root.container.children.push(
    am5xy.XYChart.new(root, {
      panX: false,
      panY: false,
      wheelX: "none",
      wheelY: "none",
      paddingLeft: 0
    })
  );

  // Y-axis (categories)
  var yRenderer = am5xy.AxisRendererY.new(root, {
    minGridDistance: 30,
    minorGridEnabled: true
  });
  yRenderer.grid.template.set("location", 1);

  var yAxis = chart.yAxes.push(
    am5xy.CategoryAxis.new(root, {
      maxDeviation: 0,
      categoryField: "category",
      renderer: yRenderer
    })
  );

  // X-axis (values)
  var xAxis = chart.xAxes.push(
    am5xy.ValueAxis.new(root, {
      maxDeviation: 0,
      min: 0,
      renderer: am5xy.AxisRendererX.new(root, {
        visible: true,
        strokeOpacity: 0.1,
        minGridDistance: 50
      })
    })
  );

  // Column series
  var series = chart.series.push(
    am5xy.ColumnSeries.new(root, {
      name: "Interventions",
      xAxis: xAxis,
      yAxis: yAxis,
      valueXField: "value",
      categoryYField: "category",
      sequencedInterpolation: true
    })
  );

  var columnTemplate = series.columns.template;
  columnTemplate.setAll({
    draggable: true,
    cursorOverStyle: "pointer",
    tooltipText: "{category}: {value} ({percent}%)",
    cornerRadiusBR: 10,
    cornerRadiusTR: 10,
    strokeOpacity: 0
  });

  columnTemplate.adapters.add("fill", (fill, target) => {
    return chart.get("colors").getIndex(series.columns.indexOf(target));
  });

  columnTemplate.adapters.add("stroke", (stroke, target) => {
    return chart.get("colors").getIndex(series.columns.indexOf(target));
  });

  columnTemplate.events.on("dragstop", () => {
    sortCategoryAxis();
  });

  function getSeriesItem(category) {
    for (var i = 0; i < series.dataItems.length; i++) {
      var dataItem = series.dataItems[i];
      if (dataItem.get("categoryY") === category) return dataItem;
    }
  }

  function sortCategoryAxis() {
    series.dataItems.sort((x, y) => y.get("graphics").y() - x.get("graphics").y());
    var easing = am5.ease.out(am5.ease.cubic);

    am5.array.each(yAxis.dataItems, function(dataItem) {
      var seriesDataItem = getSeriesItem(dataItem.get("category"));
      if (seriesDataItem) {
        var index = series.dataItems.indexOf(seriesDataItem);
        var column = seriesDataItem.get("graphics");
        var fy = yRenderer.positionToCoordinate(yAxis.indexToPosition(index)) - column.height()/2;

        if (index != dataItem.get("index")) {
          dataItem.set("index", index);
          column.set("dy", -(fy - column.y()));
          column.animate({ key: "dy", to: 0, duration: 600, easing: easing });
        } else {
          column.animate({ key: "y", to: fy, duration: 600, easing: easing });
        }
      }
    });

    yAxis.dataItems.sort((x, y) => x.get("index") - y.get("index"));
  }

  // DATA
  var data = [
    { category: "New Construction", value: 16 },
    { category: "Renovation", value: 13 }
  ];

  yAxis.data.setAll(data);
  series.data.setAll(data);

  // Add LEGEND at bottom
  var legendContainer = chart.children.push(am5.Container.new(root, {
    width: am5.percent(100),
    layout: root.horizontalLayout,
    paddingTop: 15,
    centerX: am5.percent(50),
    x: am5.percent(50)
  }));

  var legend = legendContainer.children.push(am5.Legend.new(root, {
    layout: root.horizontalLayout,
    width: am5.percent(100)
  }));

  legend.labels.template.setAll({
    maxWidth: 100,
    oversizedBehavior: "wrap",
    textAlign: "center"
  });

  legend.valueLabels.template.setAll({
    textAlign: "right"
  });

//   legend.data.setAll(series.dataItems);

  // Animate
  series.appear(1000);
  chart.appear(1000, 100);

});
</script>

</body>
</html>
